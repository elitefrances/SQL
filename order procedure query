CREATE DEFINER=`extendtv`@`%` PROCEDURE `row_fixed_filter_2020`()
BEGIN
select * FROM(
select  MOF.create_date as `IO Date`,
		MOF.zm_order_id as `ZM Order Number`,
		MOF.zendesk_id as `Zendesk Ticket #`,
		MOF.adops_order_id as `External Ticket #`,
		MOF.parent_order_id as `Parent External Ticket #`,
		MOF.station_name as `Station`,
		MOF.station_group_name as `Organization`,
		MOF.market_name as `Market`,
		MOF.accountmanager_name as `AM Team`,
		MOF.advertiser_name as `Advertiser`,
		MOF.category_name as `Category`,
		MOF.user_name as `Account Executive`,
		MOF.campaign_name as `Campaign Name` ,
		MOF.media_name as `Media`,
		MOF.tactic_name as `Tactic`,
		MOF.platform_name as `Platform`,
		CASE
			WHEN MOF.start_without_rt = -1 THEN "N/A"
			ELSE MOF.start_without_rt
		END as `Start without RT?`,
		MOF.start_date as `Start Date`,
		MOF.end_date as `End Date`,
		MOF.live_date as `Live Date`,
		MOF.retail_cpm as `Retail CPM`,
		MOF.at_cost_cpm as `At Cost CPM`,
		MOF.tier_name as `Tier`,
		@MonthDate := date_format(CONCAT(Pacing.year, "-", Pacing.month, "-1"), '%Y-%m-%d') as `Month Date`,
		Pacing.Impressions as `Impressions`,
		@Retail_Cost := MOF.retail_cpm * Pacing.Impressions/1000 as `Retail_Cost`,
		RL.region as `Regional Director`,
		CASE
			WHEN YEAR(MOF.end_date) = YEAR(current_date) AND MONTH(MOF.end_date) = MONTH(current_date) THEN "Yes"
			ELSE "No"
		END as `Ending this Month`,
		CASE
			WHEN MOF.end_date > current_date AND MOF.start_date <= current_date THEN "Live"
			ELSE "Not Live"
		END as `Live?`,
		CASE
			WHEN MOF.promo = 1 THEN "Promo" 
			ELSE "Retail" 
		END as `Revenue Type`,
		CASE
			WHEN MOF.direct = 1 then "Direct"
			ELSE "Reseller"
		END as `Customer Type`,
		@License_Fee :=
		CASE
			WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) <= 2016 THEN 0.187476565*@Retail_Cost
			WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Video' THEN 4.85*Pacing.Impressions/1000
      		        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Display' THEN 1.55*Pacing.Impressions/1000
      		        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Video' THEN 3.4*Pacing.Impressions/1000
      		        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Display' THEN 1.45*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) <8 AND MOF.media_name = 'Display' THEN 1.45*Pacing.Impressions/1000
      		        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) <8 AND MOF.media_name = 'Video' THEN 3.4*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=8 AND MOF.media_name = 'Display' THEN 1.45*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=8 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT%' THEN 3.4*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=8 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 3.5*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Display' THEN 1.3*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND upper(MOF.campaign_name) like '%_CDV_BLEND%' THEN 3.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 3.2*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' AND upper(MOF.campaign_name) not like '%_CDV_BLEND%' THEN 3*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'Datasphere' AND  MOF.media_name = 'Display' THEN 0.9*Pacing.Impressions/1000
            		WHEN MOF.station_group_name = 'Datasphere' AND  MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%'THEN 2.25*Pacing.Impressions/1000
            		WHEN MOF.station_group_name = 'Datasphere' AND  MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%'THEN 1.5*Pacing.Impressions/1000

			WHEN (MOF.station_group_name = 'Via Media' OR 'DK Media' OR 'BI Media') AND MOF.media_name = 'Video' THEN 4.5*Pacing.Impressions/1000
			WHEN (MOF.station_group_name = 'Via Media' OR 'DK Media' OR 'BI Media') AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'iHeartMedia' and YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Video' THEN 5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'iHeartMedia' and YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Display' THEN 1.9*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'iHeartMedia' and YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Video' THEN 4.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'iHeartMedia' and YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Display' THEN 1.95*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'iHeartMedia' and YEAR(@MonthDate) >= 2019 AND platform_name = 'GROUNDTRUTH' THEN 1.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'iHeartMedia' and YEAR(@MonthDate) >= 2019 AND platform_name != 'GROUNDTRUTH' AND MOF.media_name = 'Video' THEN 4.3*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'iHeartMedia' and YEAR(@MonthDate) >= 2019 AND platform_name != 'GROUNDTRUTH' AND MOF.media_name = 'Display' THEN 1.85*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'Univision' AND YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Video' THEN 5.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Univision' AND YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Display' THEN 2.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Univision' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 5.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Univision' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT%' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Univision' AND YEAR(@MonthDate) >= 2018 AND MOF.media_name = 'Display' THEN 2.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Univision' AND MOF.station_name != 'National' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Univision' AND MOF.station_name != 'National' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Univision' AND MOF.station_name = 'National' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' THEN 3.95*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Cumulus' AND YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Video' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Cumulus' AND YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Display' THEN 2*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Cumulus' AND YEAR(@MonthDate) >= 2019 AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Cumulus' AND YEAR(@MonthDate) = 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Cumulus' AND YEAR(@MonthDate) = 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name NOT like '%_OTT%' THEN 4.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Cumulus' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Cumulus' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name NOT like '%_OTT_V2%' THEN 4.0*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'Powerchord' AND MOF.media_name = 'Video' THEN 3.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Powerchord' AND MOF.media_name = 'Display' THEN 2*Pacing.Impressions/1000

			WHEN MOF.station_group_name = '1631 Digital' AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = '1631 Digital' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = '1631 Digital' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name NOT like '%_OTT%' THEN 3*Pacing.Impressions/1000
			WHEN MOF.station_group_name = '1631 Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = '1631 Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 3*Pacing.Impressions/1000
			
                        WHEN MOF.station_group_name = 'Homebase Digital' AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Homebase Digital' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Homebase Digital' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT%' THEN 3.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Homebase Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Homebase Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 3.5*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Graham Media' AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Graham Media' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 4.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Graham Media' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name NOT like '%_OTT%' THEN 3.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Graham Media' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 4.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Graham Media' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 3.0*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Pikewood Digital' AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Pikewood Digital' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 5.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Pikewood Digital' AND YEAR(@MonthDate) in (2018, 2019) AND MOF.media_name = 'Video' AND MOF.campaign_name NOT like '%_OTT%' THEN 3.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Pikewood Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Pikewood Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 3.0*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Cunningham Media' AND MOF.media_name = 'Video' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Cunningham Media' AND MOF.media_name = 'Display' THEN 2.0*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Euclid Media Group' AND MOF.media_name = 'Video' THEN 5.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Euclid Media Group' AND MOF.media_name = 'Display' THEN 2.0*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = '1797 Creative' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN 5.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = '1797 Creative' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT%' THEN 5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = '1797 Creative' AND MOF.media_name = 'Display' THEN 2.25*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'CBS ONO' AND YEAR(@MonthDate)= 2019 AND MONTH(@MonthDate) >=4 AND MOF.media_name = 'Display' THEN 2*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'CBS ONO' AND YEAR(@MonthDate)= 2019 AND MONTH(@MonthDate) >=4 AND MOF.media_name = 'Video'  THEN 5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'CBS ONO' AND YEAR(@MonthDate)> 2019 AND MOF.media_name = 'Display' THEN 2*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'CBS ONO' AND YEAR(@MonthDate)> 2019 AND MOF.media_name = 'Video' THEN 5*Pacing.Impressions/1000 

                        WHEN MOF.station_group_name = 'The Media Beast' AND MOF.media_name = 'Video' THEN 5.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'The Media Beast' AND  MOF.media_name = 'Display' THEN 2.0*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'Weigel Broadcast Group' AND MOF.media_name = 'Display' THEN 2.25*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Weigel Broadcast Group' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Weigel Broadcast Group' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 5.0*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) =8 AND MOF.media_name = 'Video'  THEN 6.5*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) =8 AND MOF.media_name = 'Display' THEN 2.75*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=9 AND MOF.media_name = 'Video'  THEN 5.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=9 AND MOF.media_name = 'Display'  THEN 1.8*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) >2019 AND MOF.media_name = 'Video' THEN 5.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) >2019 AND MOF.media_name = 'Display' THEN 1.8*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Nexstar Digital' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=9 AND MOF.media_name = 'Video' THEN 4.3*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Nexstar Digital' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=9 AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Nexstar Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' THEN 4.3*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Nexstar Digital' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Display' THEN 1.5*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'PMB Media' AND MOF.media_name = 'Video' THEN 4.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'PMB Media' AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Metro Parent Group' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Metro Parent Group' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Metro Parent Group' AND MOF.media_name = 'Display' THEN 2.25*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'Lifeboat Creative' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 6.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Lifeboat Creative' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 5.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'Lifeboat Creative' AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

                        WHEN MOF.station_group_name = 'OverTheTop Marketing' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name = 'OverTheTop Marketing' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000

                        WHEN MOF.station_group_name in ('21st Century Healthcare Consultants', 'HenkinSchultz') AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
                        WHEN MOF.station_group_name in ('21st Century Healthcare Consultants', 'HenkinSchultz') AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 5.0*Pacing.Impressions/1000
                        WHEN MOF.station_group_name in ('21st Century Healthcare Consultants', 'HenkinSchultz') AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'WFMJ' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'WFMJ' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'WFMJ' AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'KDOC' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'KDOC' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'KDOC' AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'Estrella Media' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.0*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'Estrella Media' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'Estrella Media' AND MOF.media_name = 'Display' THEN 1.8*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'Adams Outdoor' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'Adams Outdoor' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'Adams Outdoor' AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'NY Interconnect' AND MOF.media_name = 'Video' THEN 4.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'NY Interconnect' AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'HomeSlice Media' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'HomeSlice Media' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'HomeSlice Media' AND MOF.media_name = 'Display' THEN 2.0*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'Orange Theory' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.0*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'Orange Theory' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.0*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'Orange Theory' AND MOF.media_name = 'Display' THEN 2.0*Pacing.Impressions/1000

            		WHEN MOF.station_group_name = 'McLean Communications' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN 5.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'McLean Communications' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN 4.5*Pacing.Impressions/1000
           		WHEN MOF.station_group_name = 'McLean Communications' AND MOF.media_name = 'Display' THEN 2.5*Pacing.Impressions/1000

			WHEN MOF.station_group_name = 'Morgan Murphy Media' AND YEAR(@MonthDate) = 2017 AND MONTH(@MonthDate) >= 2 AND MOF.media_name = 'Video'
				AND MOF.market_name = 'YAKIMA-PASCO-RCHLND-KNNWCK' THEN 5.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Morgan Murphy Media' AND YEAR(@MonthDate) = 2017 AND MONTH(@MonthDate) >= 2 AND MOF.media_name = 'Display'
				AND MOF.market_name = 'YAKIMA-PASCO-RCHLND-KNNWCK' THEN 2.0*Pacing.Impressions/1000
			WHEN MOF.station_group_name = 'Morgan Murphy Media' AND YEAR(@MonthDate) > 2017 AND MOF.media_name = 'Video' 
				AND MOF.market_name = 'YAKIMA-PASCO-RCHLND-KNNWCK' THEN 5.0*Pacing.Impressions/1000
		        WHEN MOF.station_group_name = 'Morgan Murphy Media' AND YEAR(@MonthDate) > 2017 AND MOF.media_name = 'Display'
				AND MOF.market_name = 'YAKIMA-PASCO-RCHLND-KNNWCK' THEN 2.0*Pacing.Impressions/1000
			ELSE 0
		END as `License_Fee`,

		CASE
		WHEN MOF.station_group_name IN ('iHeartMedia', 'Univision', 'Via Media', 'DK Media', 'BI Media', 'Cumulus', '1631 Digital', 'Homebase Digital','Graham Media','Pikewood Digital','Powerchord','Cunningham Media','Euclid Media Group','1797 Creative','Weigel Broadcast Group','The Media Beast','Nexstar Digital','PMB Media','Metro Parent Group','Lifeboat Creative','OverTheTop Marketing','21st Century Healthcare Consultants','HenkinSchultz','WFMJ','Estrella Media','Adams Outdoor','Datasphere','NY Interconnect','HomeSlice Media','Orange Theory','McLean Communications') AND YEAR(@MonthDate) > 2016 THEN CAST(@License_Fee as DECIMAL)

      		WHEN MOF.station_group_name in ('Sinclair Digital Group', 'Via Media', 'DK Media', 'BI Media') AND YEAR(@MonthDate) <= 2016 THEN CAST(@License_Fee as DECIMAL)
		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Video' THEN CAST((4.85*Pacing.Impressions/1000) as DECIMAL)
      		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2017 AND MOF.media_name = 'Display' THEN CAST((1.55*Pacing.Impressions/1000) as DECIMAL)
      		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Video' THEN CAST((3.4*Pacing.Impressions/1000) as DECIMAL)
      		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2018 AND MOF.media_name = 'Display' THEN CAST((1.45*Pacing.Impressions/1000) as DECIMAL)
		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) <8 AND MOF.media_name = 'Display' THEN CAST((1.45*Pacing.Impressions/1000) as DECIMAL)
      		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) <8 AND MOF.media_name = 'Video' THEN CAST((3.4*Pacing.Impressions/1000) as DECIMAL)
		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=8 AND MOF.media_name = 'Display' THEN CAST((1.45*Pacing.Impressions/1000) as DECIMAL)
                WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=8 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT%' THEN CAST((3.4*Pacing.Impressions/1000) as DECIMAL)
                WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >=8 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT%' THEN CAST((3.5*Pacing.Impressions/1000) as DECIMAL)
                WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Display' THEN CAST((1.3*Pacing.Impressions/1000) as DECIMAL)
		WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND upper(MOF.campaign_name) like '%_CDV_BLEND%' THEN  CAST((3.15*Pacing.Impressions/1000) as DECIMAL)
                WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN CAST((3.35*Pacing.Impressions/1000) as DECIMAL)
                WHEN MOF.station_group_name = 'Sinclair Digital Group' AND YEAR(@MonthDate) > 2019 AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' AND upper(MOF.campaign_name) not like '%_CDV_BLEND%' THEN CAST((3*Pacing.Impressions/1000) as DECIMAL)

            	WHEN MOF.station_group_name = 'KDOC' AND MOF.media_name = 'Video' AND MOF.campaign_name like '%_OTT_V2%' THEN CAST((6.0*Pacing.Impressions/1000) AS DECIMAL)
           	WHEN MOF.station_group_name = 'KDOC' AND MOF.media_name = 'Video' AND MOF.campaign_name not like '%_OTT_V2%' THEN CAST((4.5*Pacing.Impressions/1000) AS DECIMAL)
       		WHEN MOF.station_group_name = 'KDOC' AND MOF.media_name = 'Display' THEN CAST((2.5*Pacing.Impressions/1000) AS DECIMAL)

      		WHEN MOF.station_group_name = 'Morgan Murphy Media' AND YEAR(@MonthDate) = 2017 AND MONTH(@MonthDate) >= 2
      			AND MOF.market_name = 'YAKIMA-PASCO-RCHLND-KNNWCK' THEN CAST(@License_Fee as DECIMAL)
      		WHEN MOF.station_group_name = 'Morgan Murphy Media' AND YEAR(@MonthDate) > 2017 
      			AND MOF.market_name = 'YAKIMA-PASCO-RCHLND-KNNWCK' THEN CAST(@License_Fee as DECIMAL)

      		WHEN MOF.station_group_name = 'CBS ONO' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >= 4 THEN CAST(@License_Fee as DECIMAL)
     		WHEN MOF.station_group_name = 'CBS ONO' AND YEAR(@MonthDate) > 2019 THEN CAST(@License_Fee as DECIMAL)
             
      		WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) = 2019 AND MONTH(@MonthDate) >= 8 THEN CAST(@License_Fee as DECIMAL)
     		WHEN MOF.station_group_name = 'Nulogic Marketing' AND YEAR(@MonthDate) > 2019 THEN CAST(@License_Fee as DECIMAL)

		ELSE MOF.at_cost_cpm * Pacing.Impressions/1000
		END as `ZM Revenue`,

		CASE
			WHEN MOF.end_date > current_date AND MOF.end_date < date_sub(current_date, INTERVAL -30 DAY) THEN "Yes"
			ELSE "No"
		END as `Ending within 30`,
		CASE
			WHEN MOF.end_date > current_date AND MOF.end_date < date_sub(current_date, INTERVAL -60 DAY) THEN "Yes"
			ELSE "No"
		END as `Ending within 60`,
		CASE
			WHEN MOF.start_date > current_date AND MOF.start_date < date_sub(current_date, INTERVAL -7 DAY) THEN "Yes"
			ELSE "No"
		END as `Started in Last 7 Days`,
		0 as `IO WeekDate`,
		CONCAT(YEAR(MOF.create_date), "-", MONTH(MOF.create_date), "-1") as `IO MonthDate`,
		CASE
			WHEN MOF.end_date = date_sub(current_date, INTERVAL -15 DAY) THEN "Yes"
			ELSE "No"
		END as `Ends in 15`,
		CASE
			WHEN MOF.end_date = date_sub(current_date, INTERVAL -30 DAY) THEN "Yes"
			ELSE "No"
		END as `Ends in 30`,
		MOF.status as `Status`,
		MOF.reporting_url as `Report Link`
from

(select b.campaign_name,
		a.year,
		a.month,
		a.impressions
from ExtendTV_campaignmonthlydistribution a
join ExtendTV_ordercampaign b
on a.order_campaign_id = b.id
group by 1,2,3,4) as Pacing

left join

(select date_format(date(CONVERT_TZ(a.create_date, 'UTC','US/Pacific')), '%Y-%m-%d') as create_date,
		a.adops_order_id as zm_order_id,
		a.zendesk_id,
		a.adops_order_id,
		a.parent_order_id,
		i.station_name,
  		case when j.station_group_name = 'Sinclair Digital Group' and i.station_name = 'Corporate - DS' then 'Datasphere'
             	     else j.station_group_name end as station_group_name,
		d.market_name,
		g.accountmanager_name,
		e.advertiser_name,
		f.category_name,
		h.user_name,
		b.campaign_name,
		k.media_name,
		l.tactic_name,
		m.platform_name,
		b.start_without_rt,
		date_format(date(b.start_date), '%Y-%m-%d') as start_date,
		date_format(date(b.end_date), '%Y-%m-%d') as end_date,
		date_format(date(b.live_date), '%Y-%m-%d') as live_date,
		b.retail_cpm,
		b.at_cost_cpm,
		o.tier_name,
		a.promo,
		a.direct,
		a.market_id,
		j.id as stationgroup_id,
		b.status,
		a.reporting_url
from ExtendTV_order a
left join ExtendTV_ordercampaign b
on a.id = b.order_id
left join ExtendTV_market d
on a.market_id = d.id
left join ExtendTV_advertiser e
on a.advertiser_id = e.id
left join ExtendTV_category f
on a.category_id = f.id
left join ExtendTV_accountmanager g
on a.accountmanager_id = g.id
left join ExtendTV_accountexecutive h
on a.accountexecutive_id = h.id
left join ExtendTV_station i
on a.station_id = i.id
left join ExtendTV_stationgroup j
on i.station_group_id_id = j.id
left join ExtendTV_media k
on b.media_id = k.id
left join ExtendTV_tactic l
on b.tactic_id = l.id
left join ExtendTV_platform m
on b.platform_id = m.id
left join ExtendTV_analyst n
on b.analyst_id = n.id
left join ExtendTV_tier o
on b.tier_id = o.id
group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29) as MOF
on Pacing.campaign_name = MOF.campaign_name

left join

ExtendTV_regionlookup_new RL
on MOF.market_id = RL.market_id 
group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42
order by MOF.create_date desc) AS filter_table 
where 
(filter_table.`Organization`='iHeartMedia' and (filter_table.`Month Date` >= '2014-01-01' and filter_table.`Month Date` < '2020-08-01') and upper(filter_table.`Campaign Name`) NOT LIKE '%DO_NOT_USE%') or 
(filter_table.`Organization` != 'iHeartMedia' and upper(filter_table.`Campaign Name`) NOT LIKE '%DO_NOT_USE%' and filter_table.`Month Date` >= '2014-01-01');

END
